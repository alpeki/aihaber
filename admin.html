<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #FF6A00;
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .admin-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            border-color: #FF6A00;
            transform: translateY(-5px);
        }

        .admin-card h2 {
            color: #FF6A00;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .admin-card p {
            color: #ccc;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #FF6A00;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #ff8533;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #333;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .form-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FF6A00;
            font-weight: 600;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #FF6A00;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status.running {
            background: #00ff0033;
            color: #00ff00;
        }

        .status.stopped {
            background: #ff000033;
            color: #ff0000;
        }

        .info-box {
            background: #2a2a2a;
            border-left: 4px solid #FF6A00;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .code-block {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI News - Admin Panel</h1>

        <div class="admin-grid">
            <div class="admin-card">
                <h2>Content Management</h2>
                <p>Total Articles: <strong id="totalArticles">0</strong></p>
                <p>Storage: <span class="status running">LocalStorage</span></p>
                <button class="btn" onclick="exportArticles()">Export Data</button>
            </div>

            <div class="admin-card">
                <h2>Published Articles</h2>
                <p>View and manage your content</p>
                <p>Last update: <strong id="lastUpdate">-</strong></p>
                <button class="btn" onclick="viewArticles()">Manage Articles</button>
            </div>

            <div class="admin-card">
                <h2>Categories</h2>
                <p>Manage article categories</p>
                <p>Active Categories: <strong id="categoryCount">4</strong></p>
                <button class="btn btn-secondary" onclick="manageCategories()">Edit Categories</button>
            </div>
        </div>

        <div class="form-section">
            <h2>âž• Add New Article (Manual)</h2>
            <div class="info-box">
                <strong>Note:</strong> Articles are stored in browser localStorage. Export your data regularly for backup.
            </div>
            
            <form id="articleForm">
                <div class="form-group">
                    <label for="title">Article Title</label>
                    <input type="text" id="title" required placeholder="Enter article title">
                </div>

                <div class="form-group">
                    <label for="excerpt">Excerpt</label>
                    <textarea id="excerpt" required placeholder="Short description of the article"></textarea>
                </div>

                <div class="form-group">
                    <label for="content">Full Content</label>
                    <textarea id="content" required placeholder="Full article content"></textarea>
                </div>

                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" required>
                        <option value="ai">AI</option>
                        <option value="tech">Technology</option>
                        <option value="robotics">Robotics</option>
                        <option value="science">Science</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="image">Image URL</label>
                    <input type="url" id="image" placeholder="https://example.com/image.jpg">
                </div>

                <button type="submit" class="btn">Publish Article</button>
            </form>
        </div>

        <div class="form-section">
            <h2>Manage Articles</h2>
            <div id="articlesList" style="margin-top: 1rem;">
                <!-- Articles will be listed here -->
            </div>
        </div>

        <div class="form-section">
            <h2>Quick Links</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="index.html" class="btn">View Website</a>
                <a href="https://github.com/alpeki/aihaber" target="_blank" class="btn btn-secondary">GitHub Repository</a>
                <button class="btn btn-secondary" onclick="clearAllData()">Clear All Data</button>
            </div>
        </div>
    </div>

    <script src="./sanitize.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadArticlesList();
        });

        // Article Form Submit
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Rate limiting check
            if (!RateLimit.check('article-submit', 5, 60000)) {
                showNotification('Too many submissions. Please wait a minute.', 'error');
                return;
            }
            
            const rawArticle = {
                id: Date.now(),
                title: document.getElementById('title').value,
                excerpt: document.getElementById('excerpt').value,
                content: document.getElementById('content').value,
                category: document.getElementById('category').value,
                image: document.getElementById('image').value || 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=250&fit=crop',
                date: new Date().toISOString().split('T')[0],
                readTime: calculateReadTime(document.getElementById('content').value),
                popular: false
            };

            // Sanitize article data
            const article = Sanitize.article(rawArticle);
            
            if (!article) {
                showNotification('Invalid article data. Please check your inputs.', 'error');
                return;
            }

            saveArticle(article);
            this.reset();
            showNotification('Article published successfully!');
            loadStats();
            loadArticlesList();
        });

        function calculateReadTime(content) {
            const wordsPerMinute = 200;
            const words = content.trim().split(/\s+/).length;
            const minutes = Math.ceil(words / wordsPerMinute);
            return `${minutes} min read`;
        }

        function saveArticle(article) {
            let articles = JSON.parse(localStorage.getItem('articles') || '[]');
            articles.unshift(article);
            localStorage.setItem('articles', JSON.stringify(articles));
            localStorage.setItem('lastUpdate', new Date().toISOString());
        }

        function loadStats() {
            const articles = JSON.parse(localStorage.getItem('articles') || '[]');
            const lastUpdate = localStorage.getItem('lastUpdate');
            
            document.getElementById('totalArticles').textContent = articles.length;
            if (lastUpdate) {
                const date = new Date(lastUpdate);
                document.getElementById('lastUpdate').textContent = date.toLocaleString();
            }
        }

        function loadArticlesList() {
            const articles = JSON.parse(localStorage.getItem('articles') || '[]');
            const container = document.getElementById('articlesList');
            
            if (articles.length === 0) {
                container.innerHTML = '<p style="color: #888;">No articles yet. Create your first article above.</p>';
                return;
            }

            container.innerHTML = articles.map(article => `
                <div style="background: #0f0f0f; border: 1px solid #333; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h3 style="color: #FF6A00; margin-bottom: 0.5rem;">${article.title}</h3>
                            <p style="color: #ccc; margin-bottom: 0.5rem;">${article.excerpt}</p>
                            <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: #888;">
                                <span>${article.category.toUpperCase()}</span>
                                <span>${article.date}</span>
                                <span>${article.readTime}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editArticle(${article.id})" class="btn btn-secondary" style="padding: 0.5rem 1rem;">Edit</button>
                            <button onclick="deleteArticle(${article.id})" class="btn" style="padding: 0.5rem 1rem; background: #ff0000;">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteArticle(id) {
            if (!confirm('Are you sure you want to delete this article?')) return;
            
            let articles = JSON.parse(localStorage.getItem('articles') || '[]');
            articles = articles.filter(a => a.id !== id);
            localStorage.setItem('articles', JSON.stringify(articles));
            
            showNotification('Article deleted');
            loadStats();
            loadArticlesList();
        }

        function editArticle(id) {
            const articles = JSON.parse(localStorage.getItem('articles') || '[]');
            const article = articles.find(a => a.id === id);
            
            if (article) {
                document.getElementById('title').value = article.title;
                document.getElementById('excerpt').value = article.excerpt;
                document.getElementById('content').value = article.content;
                document.getElementById('category').value = article.category;
                document.getElementById('image').value = article.image;
                
                deleteArticle(id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function exportArticles() {
            const articles = JSON.parse(localStorage.getItem('articles') || '[]');
            const dataStr = JSON.stringify(articles, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `articles-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showNotification('Articles exported successfully!');
        }

        function viewArticles() {
            document.getElementById('articlesList').scrollIntoView({ behavior: 'smooth' });
        }

        function manageCategories() {
            alert('Category management feature coming soon!');
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL articles? This cannot be undone!')) return;
            localStorage.removeItem('articles');
            localStorage.removeItem('lastUpdate');
            showNotification('All data cleared');
            loadStats();
            loadArticlesList();
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? '#ff0000' : '#FF6A00';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
